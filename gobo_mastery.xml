<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Saturday, October 16, 2021, 12:36 AM -->
<!-- MuClient version 5.06 -->

<!-- Plugin "gobo_mastery" generated by Plugin Wizard -->

<muclient>
<plugin
   name="gobo_mastery"
   id="feb8484a7f137ebf026258e7"
   language="Lua"
   date_written="2021-10-16 00:36:21"
   requires="5.06"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>
<script>
<![CDATA[

require "tprint"
require "wait"

general_shop_inventory = {}
buy_table = {}
max_price = 200 

--if you want to only test and see what would be bought set to 1 or else 0
only_test = 1


require "addxml"
addxml.alias{
    enabled="y",
    name="gobo_mastery_alias",
    match=[[^/gen_mast]],
    regexp="y",
    sequence="50",
    script="func_general_shop_inventory",
}

function func_general_shop_inventory ()
    wait.make (function ()

        general_shop_inventory = {}
        buy_table = {}

        Send ("list")

        local line, wildcards, styles = wait.regexp("^,-*\.$",10)

        if not line then
            print ("did not match general shop inventory")
            return
        end

        while true do
            local line, wildcards, styles = wait.regexp ([[^\|\s*(\d+)\.\|(.+?)\|\s*(\d+)\|\s*(\d+)\|$]],1,0)

            if not line then
                break
            end

            table.insert(general_shop_inventory,"")

            general_shop_inventory[#general_shop_inventory] = {}

            table.insert(general_shop_inventory[#general_shop_inventory], wildcards[1])
            table.insert(general_shop_inventory[#general_shop_inventory], wildcards[2])
            table.insert(general_shop_inventory[#general_shop_inventory], wildcards[3])
            table.insert(general_shop_inventory[#general_shop_inventory], wildcards[4])

        end

        for k,v in pairs(general_shop_inventory) do
            if (tonumber(v[3]) <= max_price) then
                table.insert(buy_table,v[1])
                if only_test == 1 then
                  print ("adding "..v[2])
                end
            end
        end

        for i=#buy_table,1,-1 do
            if only_test == 1 then
               print (buy_table[i])
            else
              Send ("buy "..buy_table[i])
            end
        end
    end)
end

--dofile (GetInfo (57)..'\\gobo_mastery.lua')

]]>
</script> 
</muclient>
